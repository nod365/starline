<!DOCTYPE html>
<html lang="ru">


<head>
    <script>
        /*! dom-to-image 10-06-2017 */
        !function (a) { "use strict"; function b(a, b) { function c(a) { return b.bgcolor && (a.style.backgroundColor = b.bgcolor), b.width && (a.style.width = b.width + "px"), b.height && (a.style.height = b.height + "px"), b.style && Object.keys(b.style).forEach(function (c) { a.style[c] = b.style[c] }), a } return b = b || {}, g(b), Promise.resolve(a).then(function (a) { return i(a, b.filter, !0) }).then(j).then(k).then(c).then(function (c) { return l(c, b.width || q.width(a), b.height || q.height(a)) }) } function c(a, b) { return h(a, b || {}).then(function (b) { return b.getContext("2d").getImageData(0, 0, q.width(a), q.height(a)).data }) } function d(a, b) { return h(a, b || {}).then(function (a) { return a.toDataURL() }) } function e(a, b) { return b = b || {}, h(a, b).then(function (a) { return a.toDataURL("image/jpeg", b.quality || 1) }) } function f(a, b) { return h(a, b || {}).then(q.canvasToBlob) } function g(a) { "undefined" == typeof a.imagePlaceholder ? v.impl.options.imagePlaceholder = u.imagePlaceholder : v.impl.options.imagePlaceholder = a.imagePlaceholder, "undefined" == typeof a.cacheBust ? v.impl.options.cacheBust = u.cacheBust : v.impl.options.cacheBust = a.cacheBust } function h(a, c) { function d(a) { var b = document.createElement("canvas"); if (b.width = c.width || q.width(a), b.height = c.height || q.height(a), c.bgcolor) { var d = b.getContext("2d"); d.fillStyle = c.bgcolor, d.fillRect(0, 0, b.width, b.height) } return b } return b(a, c).then(q.makeImage).then(q.delay(100)).then(function (b) { var c = d(a); return c.getContext("2d").drawImage(b, 0, 0), c }) } function i(a, b, c) { function d(a) { return a instanceof HTMLCanvasElement ? q.makeImage(a.toDataURL()) : a.cloneNode(!1) } function e(a, b, c) { function d(a, b, c) { var d = Promise.resolve(); return b.forEach(function (b) { d = d.then(function () { return i(b, c) }).then(function (b) { b && a.appendChild(b) }) }), d } var e = a.childNodes; return 0 === e.length ? Promise.resolve(b) : d(b, q.asArray(e), c).then(function () { return b }) } function f(a, b) { function c() { function c(a, b) { function c(a, b) { q.asArray(a).forEach(function (c) { b.setProperty(c, a.getPropertyValue(c), a.getPropertyPriority(c)) }) } a.cssText ? b.cssText = a.cssText : c(a, b) } c(window.getComputedStyle(a), b.style) } function d() { function c(c) { function d(a, b, c) { function d(a) { var b = a.getPropertyValue("content"); return a.cssText + " content: " + b + ";" } function e(a) { function b(b) { return b + ": " + a.getPropertyValue(b) + (a.getPropertyPriority(b) ? " !important" : "") } return q.asArray(a).map(b).join("; ") + ";" } var f = "." + a + ":" + b, g = c.cssText ? d(c) : e(c); return document.createTextNode(f + "{" + g + "}") } var e = window.getComputedStyle(a, c), f = e.getPropertyValue("content"); if ("" !== f && "none" !== f) { var g = q.uid(); b.className = b.className + " " + g; var h = document.createElement("style"); h.appendChild(d(g, c, e)), b.appendChild(h) } } [":before", ":after"].forEach(function (a) { c(a) }) } function e() { a instanceof HTMLTextAreaElement && (b.innerHTML = a.value), a instanceof HTMLInputElement && b.setAttribute("value", a.value) } function f() { b instanceof SVGElement && (b.setAttribute("xmlns", "http://www.w3.org/2000/svg"), b instanceof SVGRectElement && ["width", "height"].forEach(function (a) { var c = b.getAttribute(a); c && b.style.setProperty(a, c) })) } return b instanceof Element ? Promise.resolve().then(c).then(d).then(e).then(f).then(function () { return b }) : b } return c || !b || b(a) ? Promise.resolve(a).then(d).then(function (c) { return e(a, c, b) }).then(function (b) { return f(a, b) }) : Promise.resolve() } function j(a) { return s.resolveAll().then(function (b) { var c = document.createElement("style"); return a.appendChild(c), c.appendChild(document.createTextNode(b)), a }) } function k(a) { return t.inlineAll(a).then(function () { return a }) } function l(a, b, c) { return Promise.resolve(a).then(function (a) { return a.setAttribute("xmlns", "http://www.w3.org/1999/xhtml"), (new XMLSerializer).serializeToString(a) }).then(q.escapeXhtml).then(function (a) { return '<foreignObject x="0" y="0" width="100%" height="100%">' + a + "</foreignObject>" }).then(function (a) { return '<svg xmlns="http://www.w3.org/2000/svg" width="' + b + '" height="' + c + '">' + a + "</svg>" }).then(function (a) { return "data:image/svg+xml;charset=utf-8," + a }) } function m() { function a() { var a = "application/font-woff", b = "image/jpeg"; return { woff: a, woff2: a, ttf: "application/font-truetype", eot: "application/vnd.ms-fontobject", png: "image/png", jpg: b, jpeg: b, gif: "image/gif", tiff: "image/tiff", svg: "image/svg+xml" } } function b(a) { var b = /\.([^\.\/]*?)$/g.exec(a); return b ? b[1] : "" } function c(c) { var d = b(c).toLowerCase(); return a()[d] || "" } function d(a) { return a.search(/^(data:)/) !== -1 } function e(a) { return new Promise(function (b) { for (var c = window.atob(a.toDataURL().split(",")[1]), d = c.length, e = new Uint8Array(d), f = 0; f < d; f++)e[f] = c.charCodeAt(f); b(new Blob([e], { type: "image/png" })) }) } function f(a) { return a.toBlob ? new Promise(function (b) { a.toBlob(b) }) : e(a) } function g(a, b) { var c = document.implementation.createHTMLDocument(), d = c.createElement("base"); c.head.appendChild(d); var e = c.createElement("a"); return c.body.appendChild(e), d.href = b, e.href = a, e.href } function h() { var a = 0; return function () { function b() { return ("0000" + (Math.random() * Math.pow(36, 4) << 0).toString(36)).slice(-4) } return "u" + b() + a++ } } function i(a) { return new Promise(function (b, c) { var d = new Image; d.onload = function () { b(d) }, d.onerror = c, d.src = a }) } function j(a) { var b = 3e4; return v.impl.options.cacheBust && (a += (/\?/.test(a) ? "&" : "?") + (new Date).getTime()), new Promise(function (c) { function d() { if (4 === g.readyState) { if (200 !== g.status) return void (h ? c(h) : f("cannot fetch resource: " + a + ", status: " + g.status)); var b = new FileReader; b.onloadend = function () { var a = b.result.split(/,/)[1]; c(a) }, b.readAsDataURL(g.response) } } function e() { h ? c(h) : f("timeout of " + b + "ms occured while fetching resource: " + a) } function f(a) { console.error(a), c("") } var g = new XMLHttpRequest; g.onreadystatechange = d, g.ontimeout = e, g.responseType = "blob", g.timeout = b, g.open("GET", a, !0), g.send(); var h; if (v.impl.options.imagePlaceholder) { var i = v.impl.options.imagePlaceholder.split(/,/); i && i[1] && (h = i[1]) } }) } function k(a, b) { return "data:" + b + ";base64," + a } function l(a) { return a.replace(/([.*+?^${}()|\[\]\/\\])/g, "\\$1") } function m(a) { return function (b) { return new Promise(function (c) { setTimeout(function () { c(b) }, a) }) } } function n(a) { for (var b = [], c = a.length, d = 0; d < c; d++)b.push(a[d]); return b } function o(a) { return a.replace(/#/g, "%23").replace(/\n/g, "%0A") } function p(a) { var b = r(a, "border-left-width"), c = r(a, "border-right-width"); return a.scrollWidth + b + c } function q(a) { var b = r(a, "border-top-width"), c = r(a, "border-bottom-width"); return a.scrollHeight + b + c } function r(a, b) { var c = window.getComputedStyle(a).getPropertyValue(b); return parseFloat(c.replace("px", "")) } return { escape: l, parseExtension: b, mimeType: c, dataAsUrl: k, isDataUrl: d, canvasToBlob: f, resolveUrl: g, getAndEncode: j, uid: h(), delay: m, asArray: n, escapeXhtml: o, makeImage: i, width: p, height: q } } function n() { function a(a) { return a.search(e) !== -1 } function b(a) { for (var b, c = []; null !== (b = e.exec(a));)c.push(b[1]); return c.filter(function (a) { return !q.isDataUrl(a) }) } function c(a, b, c, d) { function e(a) { return new RegExp("(url\\(['\"]?)(" + q.escape(a) + ")(['\"]?\\))", "g") } return Promise.resolve(b).then(function (a) { return c ? q.resolveUrl(a, c) : a }).then(d || q.getAndEncode).then(function (a) { return q.dataAsUrl(a, q.mimeType(b)) }).then(function (c) { return a.replace(e(b), "$1" + c + "$3") }) } function d(d, e, f) { function g() { return !a(d) } return g() ? Promise.resolve(d) : Promise.resolve(d).then(b).then(function (a) { var b = Promise.resolve(d); return a.forEach(function (a) { b = b.then(function (b) { return c(b, a, e, f) }) }), b }) } var e = /url\(['"]?([^'"]+?)['"]?\)/g; return { inlineAll: d, shouldProcess: a, impl: { readUrls: b, inline: c } } } function o() { function a() { return b(document).then(function (a) { return Promise.all(a.map(function (a) { return a.resolve() })) }).then(function (a) { return a.join("\n") }) } function b() { function a(a) { return a.filter(function (a) { return a.type === CSSRule.FONT_FACE_RULE }).filter(function (a) { return r.shouldProcess(a.style.getPropertyValue("src")) }) } function b(a) { var b = []; return a.forEach(function (a) { try { q.asArray(a.cssRules || []).forEach(b.push.bind(b)) } catch (c) { console.log("Error while reading CSS rules from " + a.href, c.toString()) } }), b } function c(a) { return { resolve: function () { var b = (a.parentStyleSheet || {}).href; return r.inlineAll(a.cssText, b) }, src: function () { return a.style.getPropertyValue("src") } } } return Promise.resolve(q.asArray(document.styleSheets)).then(b).then(a).then(function (a) { return a.map(c) }) } return { resolveAll: a, impl: { readAll: b } } } function p() { function a(a) { function b(b) { return q.isDataUrl(a.src) ? Promise.resolve() : Promise.resolve(a.src).then(b || q.getAndEncode).then(function (b) { return q.dataAsUrl(b, q.mimeType(a.src)) }).then(function (b) { return new Promise(function (c, d) { a.onload = c, a.onerror = d, a.src = b }) }) } return { inline: b } } function b(c) { function d(a) { var b = a.style.getPropertyValue("background"); return b ? r.inlineAll(b).then(function (b) { a.style.setProperty("background", b, a.style.getPropertyPriority("background")) }).then(function () { return a }) : Promise.resolve(a) } return c instanceof Element ? d(c).then(function () { return c instanceof HTMLImageElement ? a(c).inline() : Promise.all(q.asArray(c.childNodes).map(function (a) { return b(a) })) }) : Promise.resolve(c) } return { inlineAll: b, impl: { newImage: a } } } var q = m(), r = n(), s = o(), t = p(), u = { imagePlaceholder: void 0, cacheBust: !1 }, v = { toSvg: b, toPng: d, toJpeg: e, toBlob: f, toPixelData: c, impl: { fontFaces: s, images: t, util: q, inliner: r, options: {} } }; "undefined" != typeof module ? module.exports = v : a.domtoimage = v }(this);
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Science+Gothic:wght@100..900&display=swap" rel="stylesheet">
    <meta charset="utf-8" />
    <title>Календарь A4</title>
    <style>
        /* Печать A4 альбом, 300 DPI */
        @page {
            size: A4 landscape;
            margin: 0;
        }

        body {
            margin: 0;
            font-family: Arial, Helvetica, sans-serif;
            background: #f0f0f0;
        }

        /* Панель управления */
        .controls {
            padding: 12px;
            background: #fff;
            text-align: center;
        }

        select,
        button {
            font-size: 16px;
            padding: 6px 10px;
            margin: 0 6px;
        }

        /* Страница A4 в пикселях при 300dpi = 3508 × 2480 */
        .page {
            width: 3508px;
            height: 2480px;
            background: #fff;
            margin: 18px auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            box-sizing: border-box;
            padding-top: 40px;
        }

        /* Заголовок месяца */
        .month-title {
            font-size: 100px;
            font-weight: 400;
            margin-top: 400px;
            margin-bottom: -100px;
            text-align: center;
        }

        /* Сетка календаря
   колонки: [100px weeknum][7 * 415px days][100px weeknum] */
        .calendar {
            display: grid;
            grid-template-columns: 100px repeat(7, 417px) 100px;
            grid-auto-rows: 250px;
            /* высота дня */
            gap: 0;
            justify-content: center;
            align-items: stretch;
        }

        /* Заголовки дней недели и заголовки колонок номеров недель */
        .weeknum-header {
            height: 80px;
            line-height: 80px;
            text-align: center;
            font-weight: 700;
            font-size: 22px;
            border: 1px solid transparent;
            box-sizing: border-box;
            background: #fff;
        }

        .weekday {
            height: 80px;
            line-height: normal;
            text-align: center;
            font-weight: 400;
            font-size: 46px;
            border: 1px solid transparent;
            box-sizing: border-box;
            background: #fff;
            margin-top: 170px;
        }

        .weekday.weekend {
            color: red;
        }

        /* Номер недели в строке */
        .weeknum {
            width: 100px;
            border: 1px solid transparent;
            box-sizing: border-box;
            text-align: center;
            font-size: 50px;
            font-weight: 500;
            line-height: 250px;
            background: #fff;
        }

        * {
            font-family: "Science Gothic", sans-serif;
            font-optical-sizing: auto;
            font-weight: 300;
            font-style: normal;
        }

        /* День */
        .day {
            width: 415px;
            height: 250px;
            box-sizing: border-box;
            padding: 0px;
            font-size: 20px;
            background: #fff;
            display: flex;
            box-shadow: 0px 0px 0px 1px;
        }

        .day.empty {
            background: #fafafa;
        }

        .day.weekend {
            color: red;
        }

        .day-number {
            font-size: 158px;
            flex: 1;
            margin: auto;
            text-align: center;
        }

        /* Печатать: убрать фон страницы вокруг */
        @media print {
            body {
                background: white;
            }

            .controls {
                display: none;
            }

            .page {
                margin: 0;
                padding-top: 20px;
            }
        }
    </style>
</head>

<body>

    <div class="controls">
        Год:
        <select id="selYear"></select>
        Месяц:
        <select id="selMonth"></select>
        <button id="btnGen">Сформировать</button>
        <button id="btnCopy">Копировать PNG</button>
    </div>

    <div class="page" id="copyThis">
        <div id="title" class="month-title"></div>
        <div id="calendar" class="calendar" aria-hidden="false"></div>
    </div>

    <script>
        /* Константы */
        const WEEKDAYS = ['понедельник', 'вторник', 'среда', 'четверг', 'пятница', 'суббота', 'воскресенье'];

        const MONTHS = [
            'ЯНВАРЬ',
            'ФЕВРАЛЬ',
            'МАРТ',
            'АПРЕЛЬ',
            'МАЙ',
            'ИЮНЬ',
            'ИЮЛЬ',
            'АВГУСТ',
            'СЕНТЯБРЬ',
            'ОКТЯБРЬ',
            'НОЯБРЬ',
            'ДЕКАБРЬ',
        ];

        const MONTHS_EN = [
            'JANUARY',
            'FEBRUARY',
            'MARCH',
            'APRIL',
            'MAY',
            'JUNE',
            'JULY',
            'AUGUST',
            'SEPTEMBER',
            'OCTOBER',
            'NOVEMBER',
            'DECEMBER',
        ];

        /* Инициализация контролов */
        (function initControls() {
            const selYear = document.getElementById('selYear');
            const selMonth = document.getElementById('selMonth');
            const now = new Date();
            const curYear = now.getFullYear();

            for (let y = curYear - 5; y <= curYear + 5; y++) {
                const opt = document.createElement('option');
                opt.value = y; opt.textContent = y;
                selYear.appendChild(opt);
            }
            MONTHS.forEach((m, i) => {
                const opt = document.createElement('option');
                opt.value = i; opt.textContent = m;
                selMonth.appendChild(opt);
            });

            selYear.value = curYear;
            selMonth.value = now.getMonth();

            document.getElementById('btnGen').addEventListener('click', generateCalendar);
            document.getElementById('btnCopy').addEventListener('click', GetImage);

            // сразу сформировать текущий месяц
            generateCalendar();
        })();

        /* Функция ISO номера недели */
        function getISOWeekNumber(date) {
            // копия UTC
            const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            const dayNum = d.getUTCDay() || 7;
            d.setUTCDate(d.getUTCDate() + 4 - dayNum);
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            const weekNo = Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
            return weekNo;
        }

        /* Основная функция генерации календаря */
        function generateCalendar() {
            const selYear = document.getElementById('selYear');
            const selMonth = document.getElementById('selMonth');
            const year = parseInt(selYear.value, 10);
            const month = parseInt(selMonth.value, 10);

            const title = document.getElementById('title');
            const calendar = document.getElementById('calendar');
            calendar.innerHTML = '';

            title.textContent = `${MONTHS[month]} / ${year} / ${MONTHS_EN[month]}`;

            // ----- шапка: пустая ячейка слева (для номера недели), дни недели, пустая справа -----
            const leftHeader = document.createElement('div');
            leftHeader.className = 'weeknum-header';
            leftHeader.textContent = ''; // можно оставить пустым
            calendar.appendChild(leftHeader);

            WEEKDAYS.forEach((dw, idx) => {
                const hd = document.createElement('div');
                hd.className = 'weekday' + (idx >= 5 ? ' weekend' : '');
                hd.textContent = dw;
                calendar.appendChild(hd);
            });

            const rightHeader = document.createElement('div');
            rightHeader.className = 'weeknum-header';
            rightHeader.textContent = '';
            calendar.appendChild(rightHeader);

            // ----- вычисления -----
            const firstDate = new Date(year, month, 1);
            let startDay = firstDate.getDay(); // 0 (Вск) .. 6 (Сб)
            if (startDay === 0) startDay = 7; // воскресенье = 7
            startDay = startDay - 1; // теперь Пн = 0 ... Вс = 6

            const daysInMonth = new Date(year, month + 1, 0).getDate();

            // создаём 6 строк (включая возможные пустые строки)
            for (let row = 0; row < 6; row++) {
                // вычислим дату, соответствующую первому дню этой строки
                const firstDayOfRow = new Date(year, month, 1 + row * 7 - startDay);
                const weekNum = getISOWeekNumber(firstDayOfRow);

                // номер недели слева
                const leftNum = document.createElement('div');
                leftNum.className = 'weeknum';
                leftNum.textContent = weekNum;
                calendar.appendChild(leftNum);

                // 7 ячеек дней
                for (let col = 0; col < 7; col++) {
                    const dayIndex = row * 7 + col - startDay + 1; // реальный номер дня месяца
                    const cell = document.createElement('div');

                    if (dayIndex < 1 || dayIndex > daysInMonth) {
                        cell.className = 'day empty';
                    } else {
                        const isWeekend = (col >= 5); // суббота(5) и воскресенье(6)
                        cell.className = 'day' + (isWeekend ? ' weekend' : '');
                        const num = document.createElement('div');
                        num.className = 'day-number';
                        num.textContent = dayIndex;
                        cell.appendChild(num);
                    }
                    calendar.appendChild(cell);
                }

                // номер недели справа
                const rightNum = document.createElement('div');
                rightNum.className = 'weeknum';
                rightNum.textContent = weekNum;
                calendar.appendChild(rightNum);
            }
        }


        function GetImage() {

            domtoimage.toBlob(document.getElementById('copyThis'))
                .then(function (blob) {
                    try {
                        navigator.clipboard.write([new ClipboardItem({ 'image/png': blob })])
                            .then(() => {
                                alert('Готово');
                            })
                            .catch(err => {
                                console.error('Ошибка при копировании в буфер обмена:', err);
                                alert('Ошибка')
                            });
                    } catch (error) {
                        console.error('Ошибка внутри try/catch:', error);
                        alert('Ошибка')
                    }
                })
                .catch(function (error) {
                    console.error('Ошибка при создании изображения:', error);
                    alert('Ошибка')
                });
        }

    </script>
</body>

</html>